<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–π –≥–æ—Ä–æ–¥–æ–∫</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: sans-serif;
            background-color: #a0d0ff; /* –ù–µ–±–æ */
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
        }
        #game-area {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            max-width: 800px;
            background-color: #8cb27c; /* –¢—Ä–∞–≤–∞ */
            padding: 30px;
            border-radius: 30px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.2);
            min-height: 400px;
        }
        .building {
            width: 80px;
            height: 80px;
            background-color: #e0c4a0;
            border: 3px solid #b08e5a;
            border-radius: 15px 15px 5px 5px;
            display: flex;
            flex-direction: column;
            justify-content flex-end;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
            transition: 0.2s;
            box-shadow: 0 5px 0 #8b6b42;
            color: #4a3b28;
            font-weight: bold;
            position: relative;
        }
        .building:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 0 #8b6b42;
        }
        .building span {
            background: rgba(255,255,255,0.7);
            width: 100%;
            text-align: center;
            font-size: 14px;
            border-radius: 0 0 10px 10px;
            padding: 4px 0;
        }
        #controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        button {
            padding: 15px 25px;
            font-size: 18px;
            border: none;
            border-radius: 15px;
            background-color: #ffd966;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 0 #b68b40;
            transition: 0.1s;
        }
        button:active {
            transform: translateY(4px);
            box-shadow: none;
        }
        #balance {
            font-size: 24px;
            background: white;
            padding: 10px 30px;
            border-radius: 40px;
            margin-bottom: 20px;
            border: 3px solid gold;
        }
    </style>
</head>
<body>
    <div id="balance">üí∞ –ú–æ–Ω–µ—Ç: <span id="balance-value">100</span></div>
    <div id="game-area" data-user-id="">
        <!-- –ó–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –¥–æ–º–∏–∫–∏ -->
    </div>
    <div id="controls">
        <button onclick="addBuilding('house')">üè† –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –¥–æ–º (10üí∞)</button>
        <button onclick="addBuilding('shop')">üè™ –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞–≥–∞–∑–∏–Ω (25üí∞)</button>
        <button onclick="collectTax()">üí∞ –°–æ–±—Ä–∞—Ç—å –Ω–∞–ª–æ–≥</button>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        let tg = window.Telegram.WebApp;
        tg.expand(); // –†–∞—Å—Ç—è–Ω—É—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
        
        let balance = 100;
        let buildings = [];

        // –≠–ª–µ–º–µ–Ω—Ç—ã
        const balanceSpan = document.getElementById('balance-value');
        const gameArea = document.getElementById('game-area');

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
        function updateBalanceDisplay() {
            balanceSpan.textContent = balance;
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –≥–æ—Ä–æ–¥–∞
        function renderCity() {
            gameArea.innerHTML = ''; // –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª–µ
            buildings.forEach((building, index) => {
                const div = document.createElement('div');
                div.className = 'building';
                div.setAttribute('data-id', index);
                div.innerHTML = `${building.emoji}<span>${building.name}</span>`;
                // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–Ω–æ—Å–∞ –∏–ª–∏ —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–∑–∂–µ
                gameArea.appendChild(div);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ—Å—Ç—Ä–æ–π–∫–∏ –∑–¥–∞–Ω–∏—è
        window.addBuilding = function(type) {
            let cost = 0;
            let emoji = '';
            let name = '';

            if (type === 'house') {
                cost = 10;
                emoji = 'üè†';
                name = '–î–æ–º';
            } else if (type === 'shop') {
                cost = 25;
                emoji = 'üè™';
                name = '–ú–∞–≥–∞–∑–∏–Ω';
            }

            if (balance >= cost) {
                balance -= cost;
                buildings.push({ type: type, emoji: emoji, name: name });
                updateBalanceDisplay();
                renderCity();

                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É (—á—Ç–æ–±—ã –æ–Ω —Å–æ—Ö—Ä–∞–Ω–∏–ª –ø—Ä–æ–≥—Ä–µ—Å—Å)
                tg.sendData(JSON.stringify({
                    action: 'build',
                    type: type,
                    balance: balance,
                    buildingsCount: buildings.length
                }));
            } else {
                tg.showAlert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
            }
        };

        // –§—É–Ω–∫—Ü–∏—è —Å–±–æ—Ä–∞ –Ω–∞–ª–æ–≥–∞
        window.collectTax = function() {
            let tax = 0;
            buildings.forEach(b => {
                if (b.type === 'house') tax += 5;
                if (b.type === 'shop') tax += 15;
            });
            
            if (tax > 0) {
                balance += tax;
                updateBalanceDisplay();
                tg.showAlert(`–í—ã —Å–æ–±—Ä–∞–ª–∏ –Ω–∞–ª–æ–≥: ${tax}üí∞`);
                
                // –°–æ–æ–±—â–∞–µ–º –±–æ—Ç—É –æ —Å–±–æ—Ä–µ –Ω–∞–ª–æ–≥–∞
                tg.sendData(JSON.stringify({
                    action: 'tax',
                    tax: tax,
                    balance: balance
                }));
            } else {
                tg.showAlert('–ù–µ—Ç –∑–¥–∞–Ω–∏–π ‚Äî –Ω–µ—Ç –Ω–∞–ª–æ–≥–æ–≤!');
            }
        };

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –±–æ—Ç –∏—Ö –ø—Ä–∏—Å–ª–∞–ª (–ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ)
        document.addEventListener('DOMContentLoaded', function() {
            // –ï—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ Telegram (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å –∫–Ω–æ–ø–∫–∏)
            if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                gameArea.dataset.userId = tg.initDataUnsafe.user.id;
                console.log('–ò–≥—Ä–æ–∫:', tg.initDataUnsafe.user.username);
            }
            
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –∑–∞–ø—Ä–æ—Å–∏—Ç—å —É –±–æ—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ HTTP, –Ω–æ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –Ω–∞—á–Ω–µ–º —Å –Ω—É–ª—è.
            // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å fetch –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É –±–æ—Ç–∞.
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        renderCity();
        updateBalanceDisplay();
        
        // –°–æ–æ–±—â–∞–µ–º –±–æ—Ç—É, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        tg.ready();
    </script>
</body>
</html>
