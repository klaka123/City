<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MEGA CITY 3000 - –ò–î–ï–ê–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø</title>
    <style>
        /* ========== –ü–û–õ–ù–û–°–¢–¨–Æ –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ù–´–ô –î–ò–ó–ê–ô–ù ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            user-select: none;
        }

        body {
            background: #0a1f30;
            overflow: hidden;
            touch-action: none;
        }

        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: radial-gradient(circle at 30% 50%, #1e5a7a, #0b2a3f);
        }

        #gameCanvas {
            display: block;
            width: 100%;
            height: 100%;
            cursor: grab;
            touch-action: none;
        }

        /* ===== –ù–ò–ñ–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ ===== */
        .ui-panel {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(20, 40, 55, 0.85);
            backdrop-filter: blur(15px);
            border-radius: 70px;
            padding: 20px 40px;
            display: flex;
            gap: 40px;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 20px 40px rgba(0,0,0,0.7);
            z-index: 100;
            border-bottom: 4px solid #4a9ec0;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
            font-size: 28px;
            font-weight: 600;
            text-shadow: 0 2px 5px black;
            background: rgba(0,0,0,0.3);
            padding: 8px 25px;
            border-radius: 50px;
        }

        .stat-icon {
            font-size: 40px;
            filter: drop-shadow(0 4px 6px black);
        }

        /* ===== –õ–ï–í–û–ï –ú–ï–ù–Æ (–ö–ê–¢–ê–õ–û–ì) ===== */
        .build-menu {
            position: fixed;
            top: 50%;
            left: 25px;
            transform: translateY(-50%);
            width: 380px;
            max-height: 80vh;
            background: rgba(15, 35, 50, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 40px;
            padding: 20px;
            border: 2px solid rgba(255,255,255,0.2);
            box-shadow: 0 25px 50px rgba(0,0,0,0.8);
            z-index: 100;
            display: flex;
            flex-direction: column;
        }

        .menu-header {
            color: white;
            font-size: 24px;
            font-weight: 700;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 30px;
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 3px solid #4a9ec0;
        }

        .category-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .cat-tab {
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 30px;
            padding: 8px 12px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .cat-tab:hover {
            background: rgba(255,255,255,0.2);
        }

        .cat-tab.active {
            background: #ffb84d;
            color: #1e3e55;
            border-color: #ff9f1c;
        }

        .buildings-list {
            flex: 1;
            overflow-y: auto;
            padding-right: 8px;
            scrollbar-width: thin;
            scrollbar-color: #4a9ec0 #1f3f55;
        }

        .buildings-list::-webkit-scrollbar {
            width: 8px;
        }

        .buildings-list::-webkit-scrollbar-thumb {
            background: #4a9ec0;
            border-radius: 10px;
        }

        .build-item {
            background: rgba(255,255,255,0.08);
            border-radius: 25px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: 0.2s;
            border: 2px solid transparent;
        }

        .build-item:hover {
            background: rgba(255,255,255,0.15);
            transform: translateX(5px);
        }

        .build-item.selected {
            border-color: #ffb84d;
            background: rgba(255,184,77,0.15);
        }

        .item-icon {
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.1);
            border-radius: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
        }

        .item-info {
            flex: 1;
        }

        .item-name {
            color: white;
            font-size: 16px;
            font-weight: 600;
        }

        .item-price {
            color: #ffd966;
            font-size: 14px;
            margin-top: 4px;
        }

        /* ===== –ü–†–ê–í–û–ï –ú–ï–ù–Æ ===== */
        .control-menu {
            position: fixed;
            top: 50%;
            right: 25px;
            transform: translateY(-50%);
            background: rgba(15, 35, 50, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 40px;
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            border: 2px solid rgba(255,255,255,0.2);
            box-shadow: 0 25px 50px rgba(0,0,0,0.8);
            z-index: 100;
            min-width: 200px;
        }

        .control-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 40px;
            padding: 18px;
            color: white;
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: 0.2s;
            border: 2px solid rgba(255,255,255,0.15);
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateX(-5px);
        }

        .control-btn.collect {
            background: rgba(46,125,50,0.4);
            border-color: #4caf50;
        }

        .control-btn.cancel {
            background: rgba(198,40,40,0.4);
            border-color: #f44336;
        }

        /* ===== –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ ===== */
        .info-panel {
            position: fixed;
            top: 25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15, 35, 50, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 50px;
            padding: 15px 40px;
            color: white;
            font-size: 22px;
            border: 2px solid rgba(255,255,255,0.2);
            z-index: 100;
            text-align: center;
            min-width: 450px;
            border-top: 4px solid #4a9ec0;
        }

        /* ===== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ===== */
        .notification {
            position: fixed;
            top: 100px;
            right: 30px;
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(15px);
            color: white;
            padding: 18px 35px;
            border-radius: 60px;
            font-size: 18px;
            z-index: 2000;
            animation: slideIn 0.3s ease;
            border: 2px solid #ffb84d;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
<div class="game-container">
    <canvas id="gameCanvas"></canvas>

    <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å -->
    <div class="ui-panel">
        <div class="stat-item"><span class="stat-icon">üí∞</span><span id="moneyDisplay">1,000,000</span></div>
        <div class="stat-item"><span class="stat-icon">üèóÔ∏è</span><span id="buildingsCount">0</span></div>
        <div class="stat-item"><span class="stat-icon">üìä</span><span id="incomeDisplay">0</span></div>
        <div class="stat-item"><span class="stat-icon">‚≠ê</span><span id="levelDisplay">1</span></div>
    </div>

    <!-- –õ–µ–≤–æ–µ –º–µ–Ω—é -->
    <div class="build-menu">
        <div class="menu-header">üèóÔ∏è –ö–ê–¢–ê–õ–û–ì (2240 –ó–î–ê–ù–ò–ô)</div>
        <div class="category-tabs" id="categoryTabs"></div>
        <div class="buildings-list" id="buildingsList"></div>
    </div>

    <!-- –ü—Ä–∞–≤–æ–µ –º–µ–Ω—é -->
    <div class="control-menu">
        <button class="control-btn collect" id="collectBtn"><span>üí∞</span> –°–ë–û–†</button>
        <button class="control-btn" id="weatherBtn"><span>üå¶Ô∏è</span> –ü–û–ì–û–î–ê</button>
        <button class="control-btn" id="timeBtn"><span>‚è∞</span> –í–†–ï–ú–Ø</button>
        <button class="control-btn cancel" id="cancelBtn"><span>‚ùå</span> –û–¢–ú–ï–ù–ê</button>
        <button class="control-btn" id="resetBtn"><span>üîÑ</span> –ù–û–í–´–ô –ì–û–†–û–î</button>
    </div>

    <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
    <div class="info-panel" id="infoPanel">üëÜ –í–´–ë–ï–†–ò–¢–ï –ó–î–ê–ù–ò–ï –ò –ù–ê–ñ–ú–ò–¢–ï –ù–ê –ö–ê–†–¢–£</div>
</div>

<script>
// ==================== –ü–†–û–°–¢–ê–Ø –†–ê–ë–û–ß–ê–Ø –õ–û–ì–ò–ö–ê ====================
(function() {
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
    const GRID_SIZE = 15; // 15x15 –∫–ª–µ—Ç–æ–∫
    const CELL_SIZE = 60;

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    let gameState = {
        money: 1000000,
        grid: [],
        selectedBuilding: null,
        weather: 'clear',
        timeOfDay: 0.6,
        buildingsCount: 0,
    };

    // –°–æ–∑–¥–∞–µ–º —Å–µ—Ç–∫—É
    for (let i = 0; i < GRID_SIZE; i++) {
        gameState.grid[i] = [];
        for (let j = 0; j < GRID_SIZE; j++) {
            gameState.grid[i][j] = null;
        }
    }

    // ==================== –ì–ï–ù–ï–†–ê–¶–ò–Ø 2240 –ó–î–ê–ù–ò–ô ====================
    const buildingTypes = [];
    const categories = [
        { emoji: 'üè†', name: '–î–æ–º', basePrice: 1000, baseIncome: 50 },
        { emoji: 'üè¢', name: '–û—Ñ–∏—Å', basePrice: 2000, baseIncome: 100 },
        { emoji: 'üè™', name: '–ú–∞–≥–∞–∑–∏–Ω', basePrice: 1500, baseIncome: 75 },
        { emoji: 'üè≠', name: '–ó–∞–≤–æ–¥', basePrice: 3000, baseIncome: 150 },
        { emoji: 'üè•', name: '–ë–æ–ª—å–Ω–∏—Ü–∞', basePrice: 2500, baseIncome: 80 },
        { emoji: 'üè´', name: '–®–∫–æ–ª–∞', basePrice: 1800, baseIncome: 60 },
        { emoji: 'üèõÔ∏è', name: '–ë–∞–Ω–∫', basePrice: 4000, baseIncome: 200 },
        { emoji: 'üè∞', name: '–ó–∞–º–æ–∫', basePrice: 5000, baseIncome: 250 },
    ];

    // –°–æ–∑–¥–∞–µ–º 280 –≤–∞—Ä–∏–∞—Ü–∏–π –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (8*280 = 2240)
    categories.forEach((cat, catIndex) => {
        for (let i = 1; i <= 280; i++) {
            buildingTypes.push({
                id: buildingTypes.length,
                emoji: cat.emoji,
                name: `${cat.name} ${i}`,
                price: Math.floor(cat.basePrice * (1 + i * 0.02)),
                income: Math.floor(cat.baseIncome * (1 + i * 0.02)),
                category: catIndex,
            });
        }
    });

    // ==================== CANVAS ====================
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        drawCity();
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
    function getCellXY(row, col) {
        const x = col * CELL_SIZE + (canvas.width - GRID_SIZE * CELL_SIZE) / 2;
        const y = row * CELL_SIZE + (canvas.height - GRID_SIZE * CELL_SIZE) / 2;
        return { x, y };
    }

    function getCellFromClick(mouseX, mouseY) {
        const startX = (canvas.width - GRID_SIZE * CELL_SIZE) / 2;
        const startY = (canvas.height - GRID_SIZE * CELL_SIZE) / 2;
        
        if (mouseX < startX || mouseX > startX + GRID_SIZE * CELL_SIZE ||
            mouseY < startY || mouseY > startY + GRID_SIZE * CELL_SIZE) {
            return { row: -1, col: -1 };
        }
        
        const col = Math.floor((mouseX - startX) / CELL_SIZE);
        const row = Math.floor((mouseY - startY) / CELL_SIZE);
        return { row, col };
    }

    // ==================== –û–¢–†–ò–°–û–í–ö–ê ====================
    function drawCity() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // –ù–µ–±–æ
        const skyGrad = ctx.createLinearGradient(0, 0, 0, canvas.height);
        if (gameState.weather === 'clear') {
            skyGrad.addColorStop(0, '#0b4b72');
            skyGrad.addColorStop(1, '#1f7aa3');
        } else if (gameState.weather === 'rain') {
            skyGrad.addColorStop(0, '#2c4f6e');
            skyGrad.addColorStop(1, '#4f7a9e');
        } else {
            skyGrad.addColorStop(0, '#1e3a50');
            skyGrad.addColorStop(1, '#345e82');
        }
        ctx.fillStyle = skyGrad;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // –†–∏—Å—É–µ–º —Å–µ—Ç–∫—É
        const startX = (canvas.width - GRID_SIZE * CELL_SIZE) / 2;
        const startY = (canvas.height - GRID_SIZE * CELL_SIZE) / 2;

        for (let row = 0; row < GRID_SIZE; row++) {
            for (let col = 0; col < GRID_SIZE; col++) {
                const x = startX + col * CELL_SIZE;
                const y = startY + row * CELL_SIZE;

                // –ó–µ–º–ª—è
                ctx.fillStyle = '#7cb57c';
                ctx.shadowColor = '#2b4d2b';
                ctx.shadowBlur = 10;
                ctx.shadowOffsetY = 5;
                ctx.fillRect(x, y, CELL_SIZE - 2, CELL_SIZE - 2);
                ctx.shadowBlur = 0;

                // –ó–¥–∞–Ω–∏–µ
                const building = gameState.grid[row][col];
                if (building !== null) {
                    const type = buildingTypes[building.type];
                    ctx.fillStyle = `hsl(${building.type * 10 % 360}, 70%, 60%)`;
                    ctx.fillRect(x + 2, y + 2, CELL_SIZE - 6, CELL_SIZE - 6);
                    
                    ctx.font = '30px "Segoe UI Emoji"';
                    ctx.fillStyle = 'white';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(type.emoji, x + CELL_SIZE/2, y + CELL_SIZE/2);
                }

                // –ù–æ–º–µ—Ä –∫–ª–µ—Ç–∫–∏ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
                ctx.font = '12px Arial';
                ctx.fillStyle = 'rgba(255,255,255,0.3)';
                ctx.fillText(`${row},${col}`, x + 5, y + 15);
            }
        }

        // –†–∞–º–∫–∞
        ctx.strokeStyle = '#ffd700';
        ctx.lineWidth = 4;
        ctx.strokeRect(startX, startY, GRID_SIZE * CELL_SIZE, GRID_SIZE * CELL_SIZE);
    }

    // ==================== –ö–õ–ò–ö –ü–û –ö–ê–ù–í–ê–°–£ ====================
    canvas.addEventListener('click', (e) => {
        const rect = canvas.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        const mouseY = e.clientY - rect.top;
        
        const { row, col } = getCellFromClick(mouseX, mouseY);
        
        if (row !== -1 && col !== -1) {
            if (gameState.selectedBuilding !== null) {
                // –°—Ç—Ä–æ–∏–º
                const type = buildingTypes[gameState.selectedBuilding];
                
                if (gameState.money < type.price) {
                    showNotification(`‚ùå –ù—É–∂–Ω–æ ${type.price} –º–æ–Ω–µ—Ç!`, 'error');
                    return;
                }
                
                if (gameState.grid[row][col] !== null) {
                    showNotification('‚ùå –ö–ª–µ—Ç–∫–∞ –∑–∞–Ω—è—Ç–∞!', 'error');
                    return;
                }
                
                gameState.money -= type.price;
                gameState.grid[row][col] = { type: gameState.selectedBuilding };
                gameState.buildingsCount++;
                
                updateUI();
                drawCity();
                showNotification(`‚úÖ –ü–æ—Å—Ç—Ä–æ–µ–Ω–æ: ${type.name}`, 'success');
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                const building = gameState.grid[row][col];
                if (building) {
                    const type = buildingTypes[building.type];
                    showNotification(`${type.emoji} ${type.name} | –î–æ—Ö–æ–¥: ${type.income}`, 'info');
                }
            }
        }
    });

    // ==================== –û–ë–ù–û–í–õ–ï–ù–ò–ï UI ====================
    function updateUI() {
        document.getElementById('moneyDisplay').innerText = gameState.money.toLocaleString();
        document.getElementById('buildingsCount').innerText = gameState.buildingsCount;
        
        let totalIncome = 0;
        for (let row = 0; row < GRID_SIZE; row++) {
            for (let col = 0; col < GRID_SIZE; col++) {
                if (gameState.grid[row][col]) {
                    totalIncome += buildingTypes[gameState.grid[row][col].type].income;
                }
            }
        }
        document.getElementById('incomeDisplay').innerText = totalIncome;
        document.getElementById('levelDisplay').innerText = Math.floor(gameState.buildingsCount / 5) + 1;
    }

    // ==================== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ====================
    function showNotification(msg, type) {
        const notif = document.createElement('div');
        notif.className = 'notification';
        notif.textContent = msg;
        if (type === 'success') notif.style.borderColor = '#4caf50';
        if (type === 'error') notif.style.borderColor = '#f44336';
        document.body.appendChild(notif);
        setTimeout(() => notif.remove(), 3000);
    }

    // ==================== –ü–û–°–¢–†–û–ï–ù–ò–ï –ú–ï–ù–Æ ====================
    function buildMenu() {
        const tabs = document.getElementById('categoryTabs');
        const list = document.getElementById('buildingsList');

        // –ö–Ω–æ–ø–∫–∞ "–í—Å–µ"
        const allBtn = document.createElement('button');
        allBtn.className = 'cat-tab active';
        allBtn.textContent = 'üèÅ –í–°–ï';
        tabs.appendChild(allBtn);

        categories.forEach((cat, index) => {
            const btn = document.createElement('button');
            btn.className = 'cat-tab';
            btn.textContent = `${cat.emoji} ${cat.name}`;
            btn.dataset.cat = index;
            tabs.appendChild(btn);
        });

        function showCategory(catId) {
            list.innerHTML = '';
            let filtered = buildingTypes;
            if (catId !== undefined) {
                filtered = buildingTypes.filter(b => b.category == catId);
            }
            
            filtered.slice(0, 100).forEach(b => { // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ 100 –∑–¥–∞–Ω–∏–π
                const item = document.createElement('div');
                item.className = 'build-item';
                item.innerHTML = `
                    <div class="item-icon">${b.emoji}</div>
                    <div class="item-info">
                        <div class="item-name">${b.name}</div>
                        <div class="item-price">üí∞ ${b.price}</div>
                    </div>
                `;
                item.onclick = () => {
                    document.querySelectorAll('.build-item').forEach(i => i.classList.remove('selected'));
                    item.classList.add('selected');
                    gameState.selectedBuilding = b.id;
                    document.getElementById('infoPanel').innerHTML = `–í—ã–±—Ä–∞–Ω–æ: ${b.name}`;
                };
                list.appendChild(item);
            });
        }

        document.querySelectorAll('.cat-tab').forEach(tab => {
            tab.onclick = () => {
                document.querySelectorAll('.cat-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                showCategory(tab.dataset.cat);
            };
        });

        showCategory();
    }

    // ==================== –ö–ù–û–ü–ö–ò ====================
    document.getElementById('collectBtn').onclick = () => {
        let total = 0;
        for (let row = 0; row < GRID_SIZE; row++) {
            for (let col = 0; col < GRID_SIZE; col++) {
                if (gameState.grid[row][col]) {
                    total += buildingTypes[gameState.grid[row][col].type].income;
                }
            }
        }
        gameState.money += total;
        updateUI();
        drawCity();
        showNotification(`üí∞ –°–æ–±—Ä–∞–Ω–æ ${total} –º–æ–Ω–µ—Ç!`, 'success');
    };

    document.getElementById('weatherBtn').onclick = () => {
        const weathers = ['clear', 'rain', 'snow'];
        const current = weathers.indexOf(gameState.weather);
        gameState.weather = weathers[(current + 1) % weathers.length];
        drawCity();
        showNotification(`üå¶Ô∏è –ü–æ–≥–æ–¥–∞: ${gameState.weather}`, 'info');
    };

    document.getElementById('timeBtn').onclick = () => {
        gameState.timeOfDay = (gameState.timeOfDay + 0.3) % 1;
        drawCity();
        showNotification(`‚è∞ –í—Ä–µ–º—è –∏–∑–º–µ–Ω–µ–Ω–æ`, 'info');
    };

    document.getElementById('cancelBtn').onclick = () => {
        gameState.selectedBuilding = null;
        document.querySelectorAll('.build-item').forEach(i => i.classList.remove('selected'));
        document.getElementById('infoPanel').innerHTML = 'üëÜ –í—ã–±–µ—Ä–∏—Ç–µ –∑–¥–∞–Ω–∏–µ';
        showNotification('‚ùå –í—ã–±–æ—Ä –æ—Ç–º–µ–Ω—ë–Ω', 'info');
    };

    document.getElementById('resetBtn').onclick = () => {
        if (confirm('–ù–æ–≤—ã–π –≥–æ—Ä–æ–¥?')) {
            gameState.money = 1000000;
            gameState.buildingsCount = 0;
            gameState.selectedBuilding = null;
            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    gameState.grid[i][j] = null;
                }
            }
            updateUI();
            drawCity();
            showNotification('üîÑ –ù–æ–≤—ã–π –≥–æ—Ä–æ–¥ —Å–æ–∑–¥–∞–Ω', 'info');
        }
    };

    // ==================== –ó–ê–ü–£–°–ö ====================
    buildMenu();
    updateUI();
    drawCity();
})();
</script>
</body>
</html>
