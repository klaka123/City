<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ì–†–ê–ù–î –°–ò–¢–ò 10K - –§–ò–ù–ê–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø</title>
    <style>
        /* ========== –ò–ù–¢–ï–†–§–ï–ô–° - –ü–†–ï–ú–ò–£–ú –î–ò–ó–ê–ô–ù ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            user-select: none;
        }
        body {
            background: #0a1f30;
            overflow: hidden;
            touch-action: none;
        }
        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: radial-gradient(circle at 30% 50%, #1e5a7a, #0b2a3f);
        }
        #gameCanvas {
            display: block;
            width: 100%;
            height: 100%;
            cursor: grab;
            touch-action: none;
        }
        #gameCanvas:active {
            cursor: grabbing;
        }

        /* ===== –ù–ò–ñ–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ ===== */
        .ui-panel {
            position: fixed;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(20, 40, 55, 0.85);
            backdrop-filter: blur(15px);
            border-radius: 70px;
            padding: 18px 40px;
            display: flex;
            gap: 40px;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 20px 40px rgba(0,0,0,0.7);
            z-index: 100;
            border-bottom: 4px solid #4a9ec0;
        }
        .stat-item {
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
            font-size: 28px;
            font-weight: 600;
            text-shadow: 0 2px 5px black;
            background: rgba(0,0,0,0.3);
            padding: 8px 25px;
            border-radius: 50px;
        }
        .stat-icon {
            font-size: 40px;
            filter: drop-shadow(0 4px 6px black);
        }

        /* ===== –õ–ï–í–û–ï –ú–ï–ù–Æ (–ö–ê–¢–ê–õ–û–ì) ===== */
        .build-menu {
            position: fixed;
            top: 50%;
            left: 25px;
            transform: translateY(-50%);
            width: 400px;
            max-height: 85vh;
            background: rgba(15, 35, 50, 0.9);
            backdrop-filter: blur(15px);
            border-radius: 40px;
            padding: 20px;
            border: 2px solid rgba(255,255,255,0.2);
            box-shadow: 0 25px 50px rgba(0,0,0,0.8);
            z-index: 100;
            display: flex;
            flex-direction: column;
        }
        .menu-header {
            color: white;
            font-size: 24px;
            font-weight: 700;
            padding: 15px 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 30px;
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 3px solid #4a9ec0;
        }
        .category-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 20px;
            justify-content: center;
        }
        .cat-tab {
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 30px;
            padding: 8px 12px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .cat-tab:hover {
            background: rgba(255,255,255,0.2);
        }
        .cat-tab.active {
            background: #ffb84d;
            color: #1e3e55;
            border-color: #ff9f1c;
            box-shadow: 0 0 15px #ffb84d;
        }
        .buildings-list {
            flex: 1;
            overflow-y: auto;
            padding-right: 8px;
            scrollbar-width: thin;
            scrollbar-color: #4a9ec0 #1f3f55;
        }
        .buildings-list::-webkit-scrollbar {
            width: 8px;
        }
        .buildings-list::-webkit-scrollbar-thumb {
            background: #4a9ec0;
            border-radius: 10px;
        }
        .build-item {
            background: rgba(255,255,255,0.08);
            border-radius: 25px;
            padding: 12px 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: 0.2s;
            border: 2px solid transparent;
        }
        .build-item:hover {
            background: rgba(255,255,255,0.15);
            transform: translateX(5px);
        }
        .build-item.selected {
            border-color: #ffb84d;
            background: rgba(255,184,77,0.15);
        }
        .item-icon {
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.1);
            border-radius: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
        }
        .item-info {
            flex: 1;
        }
        .item-name {
            color: white;
            font-size: 16px;
            font-weight: 600;
        }
        .item-price {
            color: #ffd966;
            font-size: 14px;
            margin-top: 4px;
        }

        /* ===== –ü–†–ê–í–û–ï –ú–ï–ù–Æ (–ö–ù–û–ü–ö–ò) ===== */
        .control-menu {
            position: fixed;
            top: 50%;
            right: 25px;
            transform: translateY(-50%);
            background: rgba(15, 35, 50, 0.9);
            backdrop-filter: blur(15px);
            border-radius: 40px;
            padding: 25px 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            border: 2px solid rgba(255,255,255,0.2);
            box-shadow: 0 25px 50px rgba(0,0,0,0.8);
            z-index: 100;
            min-width: 220px;
        }
        .control-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 40px;
            padding: 18px 20px;
            color: white;
            font-size: 22px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: 0.2s;
            border: 2px solid rgba(255,255,255,0.15);
        }
        .control-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateX(-5px);
        }
        .control-btn:active {
            transform: scale(0.98);
        }
        .control-btn.collect {
            background: rgba(46,125,50,0.4);
            border-color: #4caf50;
        }
        .control-btn.cancel {
            background: rgba(198,40,40,0.4);
            border-color: #f44336;
        }

        /* ===== –í–ï–†–•–ù–Ø–Ø –ò–ù–§–û-–ü–ê–ù–ï–õ–¨ ===== */
        .info-panel {
            position: fixed;
            top: 25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15, 35, 50, 0.9);
            backdrop-filter: blur(15px);
            border-radius: 50px;
            padding: 15px 40px;
            color: white;
            font-size: 24px;
            font-weight: 500;
            border: 2px solid rgba(255,255,255,0.2);
            z-index: 100;
            text-align: center;
            min-width: 500px;
            border-top: 4px solid #4a9ec0;
        }

        /* ===== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ===== */
        .notification {
            position: fixed;
            top: 120px;
            right: 30px;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(15px);
            color: white;
            padding: 18px 35px;
            border-radius: 60px;
            font-size: 20px;
            z-index: 2000;
            animation: slideIn 0.3s ease;
            border: 2px solid #ffb84d;
            box-shadow: 0 15px 30px black;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
<div class="game-container">
    <canvas id="gameCanvas"></canvas>

    <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div class="ui-panel">
        <div class="stat-item"><span class="stat-icon">üí∞</span><span id="moneyDisplay">100,000,000</span></div>
        <div class="stat-item"><span class="stat-icon">üë•</span><span id="popDisplay">0</span></div>
        <div class="stat-item"><span class="stat-icon">üìä</span><span id="incomeDisplay">0</span></div>
        <div class="stat-item"><span class="stat-icon">üèóÔ∏è</span><span id="buildingsCount">0/10000</span></div>
    </div>

    <!-- –õ–µ–≤–æ–µ –º–µ–Ω—é (–∫–∞—Ç–∞–ª–æ–≥) -->
    <div class="build-menu">
        <div class="menu-header">üèóÔ∏è –ú–ï–ì–ê-–ö–ê–¢–ê–õ–û–ì (10240 –ó–î–ê–ù–ò–ô)</div>
        <div class="category-tabs" id="categoryTabs"></div>
        <div class="buildings-list" id="buildingsList"></div>
    </div>

    <!-- –ü—Ä–∞–≤–æ–µ –º–µ–Ω—é (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ) -->
    <div class="control-menu">
        <button class="control-btn collect" id="collectBtn"><span>üí∞</span> –°–ë–û–† –ù–ê–õ–û–ì–û–í</button>
        <button class="control-btn" id="weatherBtn"><span>üå¶Ô∏è</span> –ü–û–ì–û–î–ê</button>
        <button class="control-btn" id="timeBtn"><span>‚è∞</span> –í–†–ï–ú–Ø</button>
        <button class="control-btn" id="statsBtn"><span>üìà</span> –°–¢–ê–¢–ò–°–¢–ò–ö–ê</button>
        <button class="control-btn cancel" id="cancelBtn"><span>‚ùå</span> –û–¢–ú–ï–ù–ê</button>
        <button class="control-btn" id="resetBtn"><span>üîÑ</span> –ù–û–í–´–ô –ì–û–†–û–î</button>
        <button class="control-btn" id="saveBtn"><span>üíæ</span> –°–û–•–†–ê–ù–ò–¢–¨</button>
        <button class="control-btn" id="loadBtn"><span>üìÇ</span> –ó–ê–ì–†–£–ó–ò–¢–¨</button>
    </div>

    <!-- –í–µ—Ä—Ö–Ω—è—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="info-panel" id="infoPanel">üëÜ –í–´–ë–ï–†–ò–¢–ï –ó–î–ê–ù–ò–ï –ò –ù–ê–ñ–ú–ò–¢–ï –ù–ê –ö–ê–†–¢–£</div>
</div>

<script>
(function() {
    // ==================== Telegram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ====================
    let tg = null;
    try {
        if (window.Telegram?.WebApp) {
            tg = Telegram.WebApp;
            tg.expand();
            tg.ready();
        }
    } catch {}

    // ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ====================
    const CONFIG = {
        GRID_SIZE: 80,               // 80x80 = 6400 –∫–ª–µ—Ç–æ–∫
        CELL_SIZE: 70,
        TAX_COOLDOWN: 5000,           // 5 —Å–µ–∫—É–Ω–¥
        MAX_ZOOM: 3.0,
        MIN_ZOOM: 0.4,
        ZOOM_SPEED: 0.1,
        START_MONEY: 100000000,
    };

    // ==================== –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–´ ====================
    const gameState = {
        money: CONFIG.START_MONEY,
        grid: [],
        population: 0,
        lastTaxTime: Date.now(),
        selectedBuilding: null,
        weather: 'clear',
        timeOfDay: 0.6,
        camera: { x: 0, y: 0, zoom: 1 },
        isDragging: false,
        lastMouseX: 0,
        lastMouseY: 0,
        buildingsCount: 0,
        currentCategory: 'all',
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∫–∏
    for (let r = 0; r < CONFIG.GRID_SIZE; r++) {
        gameState.grid[r] = [];
        for (let c = 0; c < CONFIG.GRID_SIZE; c++) {
            gameState.grid[r][c] = 'empty';
        }
    }

    // ==================== –ì–ï–ù–ï–†–ê–¶–ò–Ø 10240 –£–ù–ò–ö–ê–õ–¨–ù–´–• –ó–î–ê–ù–ò–ô ====================
    const buildings = {};

    // 32 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
    const categories = [
        { id: 'res1', name: '–ñ–∏–ª—ã–µ', emoji: 'üèòÔ∏è', basePrice: 1000 },
        { id: 'res2', name: '–≠–ª–∏—Ç–Ω–æ–µ –∂–∏–ª—å—ë', emoji: 'üè∞', basePrice: 5000 },
        { id: 'res3', name: '–î–∞—á–Ω—ã–µ', emoji: 'üè°', basePrice: 800 },
        { id: 'com1', name: '–¢–æ—Ä–≥–æ–≤–ª—è', emoji: 'üè™', basePrice: 1500 },
        { id: 'com2', name: '–†—ã–Ω–∫–∏', emoji: 'üè¨', basePrice: 3000 },
        { id: 'com3', name: '–û—Ñ–∏—Å—ã', emoji: 'üèõÔ∏è', basePrice: 4000 },
        { id: 'ind1', name: '–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å', emoji: 'üè≠', basePrice: 2000 },
        { id: 'ind2', name: '–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞', emoji: '‚ö°', basePrice: 8000 },
        { id: 'ind3', name: '–°–∫–ª–∞–¥—ã', emoji: 'üì¶', basePrice: 1200 },
        { id: 'inf1', name: '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç', emoji: 'üöâ', basePrice: 3000 },
        { id: 'inf2', name: '–î–æ—Ä–æ–≥–∏', emoji: 'üõ£Ô∏è', basePrice: 500 },
        { id: 'inf3', name: '–ú–æ—Å—Ç—ã', emoji: 'üåâ', basePrice: 6000 },
        { id: 'cul1', name: '–ö—É–ª—å—Ç—É—Ä–∞', emoji: 'üé≠', basePrice: 2500 },
        { id: 'cul2', name: '–ú—É–∑–µ–∏', emoji: 'üèõÔ∏è', basePrice: 4500 },
        { id: 'cul3', name: '–¢–µ–∞—Ç—Ä—ã', emoji: 'üé™', basePrice: 3500 },
        { id: 'spt1', name: '–°–ø–æ—Ä—Ç', emoji: '‚öΩ', basePrice: 3000 },
        { id: 'spt2', name: '–°—Ç–∞–¥–∏–æ–Ω—ã', emoji: 'üèüÔ∏è', basePrice: 7000 },
        { id: 'spt3', name: '–§–∏—Ç–Ω–µ—Å', emoji: 'üí™', basePrice: 2000 },
        { id: 'edu1', name: '–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ', emoji: 'üìö', basePrice: 2800 },
        { id: 'edu2', name: '–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã', emoji: 'üéì', basePrice: 6000 },
        { id: 'edu3', name: '–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏', emoji: 'üìñ', basePrice: 2200 },
        { id: 'med1', name: '–ú–µ–¥–∏—Ü–∏–Ω–∞', emoji: 'üè•', basePrice: 3500 },
        { id: 'med2', name: '–ö–ª–∏–Ω–∏–∫–∏', emoji: 'üíä', basePrice: 2500 },
        { id: 'med3', name: '–ê–ø—Ç–µ–∫–∏', emoji: 'üíâ', basePrice: 1200 },
        { id: 'gov1', name: '–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ', emoji: 'üèõÔ∏è', basePrice: 5000 },
        { id: 'gov2', name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è', emoji: 'üìú', basePrice: 4000 },
        { id: 'gov3', name: '–ü–æ—á—Ç–∞', emoji: '‚úâÔ∏è', basePrice: 800 },
        { id: 'rel1', name: '–†–µ–ª–∏–≥–∏—è', emoji: '‚õ™', basePrice: 4500 },
        { id: 'rel2', name: '–•—Ä–∞–º—ã', emoji: 'üïç', basePrice: 5500 },
        { id: 'mil1', name: '–í–æ–µ–Ω–Ω—ã–µ', emoji: 'üéñÔ∏è', basePrice: 6000 },
        { id: 'mil2', name: '–û–±–æ—Ä–æ–Ω–∞', emoji: 'üõ°Ô∏è', basePrice: 5000 },
        { id: 'agr1', name: '–°–µ–ª—å—Å–∫–æ–µ', emoji: 'üåæ', basePrice: 1000 }
    ];

    // –ú–∞—Å—Å–∏–≤—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏–π (—É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å)
    const prefixes = ['–ú–∞–ª—ã–π', '–°—Ä–µ–¥–Ω–∏–π', '–ë–æ–ª—å—à–æ–π', '–û–≥—Ä–æ–º–Ω—ã–π', '–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–π', '–ú–∏–Ω–∏', '–ú–∞–∫—Å–∏', '–°—É–ø–µ—Ä', '–£–ª—å—Ç—Ä–∞', '–ú–µ–≥–∞',
                      '–°–µ–≤–µ—Ä–Ω—ã–π', '–Æ–∂–Ω—ã–π', '–ó–∞–ø–∞–¥–Ω—ã–π', '–í–æ—Å—Ç–æ—á–Ω—ã–π', '–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π', '–ù–æ–≤—ã–π', '–°—Ç–∞—Ä—ã–π', '–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π',
                      '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π', '–≠–ª–∏—Ç–Ω—ã–π', '–ë—é–¥–∂–µ—Ç–Ω—ã–π', '–ü—Ä–µ–º–∏—É–º', '–õ—é–∫—Å', '–≠–∫–æ–Ω–æ–º', '–ù–∞—Ä–æ–¥–Ω—ã–π', '–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π',
                      '–§—É—Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π', '–†–µ—Ç—Ä–æ', '–°–∫–∞–∑–æ—á–Ω—ã–π', '–î—Ä–µ–≤–Ω–∏–π', '–ü–æ–¥–∑–µ–º–Ω—ã–π', '–ù–µ–±–µ—Å–Ω—ã–π', '–ü—Ä–∏–±—Ä–µ–∂–Ω—ã–π', '–õ–µ—Å–Ω–æ–π'];
    const suffixes = ['–¶–µ–Ω—Ç—Ä', '–ö–æ–º–ø–ª–µ–∫—Å', '–ü–ª–∞–∑–∞', '–•–æ–ª–ª', '–î–æ–º', '–ó–¥–∞–Ω–∏–µ', '–°–æ–æ—Ä—É–∂–µ–Ω–∏–µ', '–¢–µ—Ä–º–∏–Ω–∞–ª', '–ü–∞—Ä–∫', '–°–∏—Ç–∏',
                      '–¢–∞—É–Ω', '–í–∏–ª–ª–∏–¥–∂', '–ü–∞–ª–∞—Å', '–¢–∞—É—ç—Ä', '–î–≤–æ—Ä–µ—Ü', '–ö—Ä–µ–ø–æ—Å—Ç—å', '–ë–∞—à–Ω—è', '–ì–∞–ª–µ—Ä–µ—è', '–ê—Ä–µ–Ω–∞', '–î–æ–∫'];

    // –¢–∏–ø—ã –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    const typeNames = {
        residential: ['–î–æ–º', '–ö–æ—Ç—Ç–µ–¥–∂', '–û—Å–æ–±–Ω—è–∫', '–ê–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã', '–†–µ–∑–∏–¥–µ–Ω—Ü–∏—è', '–í–∏–ª–ª–∞', '–¢–∞—É–Ω—Ö–∞—É—Å', '–®–∞–ª–µ', '–ë—É–Ω–≥–∞–ª–æ', '–§–∞–∑–µ–Ω–¥–∞'],
        elite: ['–ü–µ–Ω—Ç—Ö–∞—É—Å', '–õ–æ—Ñ—Ç', '–î—É–ø–ª–µ–∫—Å', '–¢—Ä–∏–ø–ª–µ–∫—Å', '–ú–µ–≥–∞-–æ—Å–æ–±–Ω—è–∫', '–î–≤–æ—Ä–µ—Ü', '–ó–∞–º–æ–∫'],
        dacha: ['–î–∞—á–∞', '–°–∞—Ä–∞–π', '–•–∏–∂–∏–Ω–∞', '–ò–∑–±–∞', '–¢–µ—Ä–µ–º'],
        trade: ['–ú–∞–≥–∞–∑–∏–Ω', '–ë—É—Ç–∏–∫', '–¢–¶', '–†—ã–Ω–æ–∫', '–°—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç', '–ì–∏–ø–µ—Ä–º–∞—Ä–∫–µ—Ç', '–£–Ω–∏–≤–µ—Ä–º–∞–≥', '–ú–æ–ª–ª', '–õ–∞–≤–∫–∞', '–ü–∞–≤–∏–ª—å–æ–Ω'],
        office: ['–û—Ñ–∏—Å', '–ë–∏–∑–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä', '–ö–æ–≤–æ—Ä–∫–∏–Ω–≥', '–¢–µ—Ö–Ω–æ–ø–∞—Ä–∫', '–ò–Ω–∫—É–±–∞—Ç–æ—Ä'],
        industry: ['–ó–∞–≤–æ–¥', '–§–∞–±—Ä–∏–∫–∞', '–¶–µ—Ö', '–ö–æ–º–±–∏–Ω–∞—Ç', '–ú–∞–Ω—É—Ñ–∞–∫—Ç—É—Ä–∞', '–°–∫–ª–∞–¥', '–î–µ–ø–æ', '–•—Ä–∞–Ω–∏–ª–∏—â–µ', '–≠–ª–µ–≤–∞—Ç–æ—Ä', '–ú–µ–ª—å–Ω–∏—Ü–∞'],
        energy: ['–≠–ª–µ–∫—Ç—Ä–æ—Å—Ç–∞–Ω—Ü–∏—è', '–ü–æ–¥—Å—Ç–∞–Ω—Ü–∏—è', '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è', '–°–µ—Ç—å', '–≠–Ω–µ—Ä–≥–∏—è', '–ú–æ—â–Ω–æ—Å—Ç—å', '–†–µ—Å—É—Ä—Å', '–°–Ω–∞–±–∂–µ–Ω–∏–µ', '–¢–µ–ø–ª–æ—Å–µ—Ç—å'],
        transport: ['–í–æ–∫–∑–∞–ª', '–ê—ç—Ä–æ–ø–æ—Ä—Ç', '–ü–æ—Ä—Ç', '–°—Ç–∞–Ω—Ü–∏—è', '–û—Å—Ç–∞–Ω–æ–≤–∫–∞', '–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞', '–î–µ–ø–æ', '–ì–∞—Ä–∞–∂', '–ü–∞—Ä–∫–æ–≤–∫–∞', '–•–∞–±'],
        road: ['–î–æ—Ä–æ–≥–∞', '–ú–æ—Å—Ç', '–¢–æ–Ω–Ω–µ–ª—å', '–≠—Å—Ç–∞–∫–∞–¥–∞', '–†–∞–∑–≤—è–∑–∫–∞', '–ü—É—Ç–µ–ø—Ä–æ–≤–æ–¥', '–ü–µ—Ä–µ—Ö–æ–¥'],
        culture: ['–¢–µ–∞—Ç—Ä', '–ú—É–∑–µ–π', '–ì–∞–ª–µ—Ä–µ—è', '–§–∏–ª–∞—Ä–º–æ–Ω–∏—è', '–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–æ—Ä–∏—è', '–í—ã—Å—Ç–∞–≤–∫–∞', '–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä', '–¶–∏—Ä–∫', '–ü–ª–∞–Ω–µ—Ç–∞—Ä–∏–π'],
        sport: ['–°—Ç–∞–¥–∏–æ–Ω', '–ê—Ä–µ–Ω–∞', '–°–ø–æ—Ä—Ç–∫–æ–º–ø–ª–µ–∫—Å', '–ë–∞—Å—Å–µ–π–Ω', '–ö–æ—Ä—Ç', '–¢—Ä–µ–∫', '–ó–∞–ª', '–ü–ª–æ—â–∞–¥–∫–∞', '–ö–∞—Ç–æ–∫', '–§–∏—Ç–Ω–µ—Å'],
        education: ['–®–∫–æ–ª–∞', '–ì–∏–º–Ω–∞–∑–∏—è', '–õ–∏—Ü–µ–π', '–ö–æ–ª–ª–µ–¥–∂', '–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç', '–ê–∫–∞–¥–µ–º–∏—è', '–ò–Ω—Å—Ç–∏—Ç—É—Ç', '–¢–µ—Ö–Ω–∏–∫—É–º', '–£—á–∏–ª–∏—â–µ', '–î–µ—Ç—Å–∞–¥'],
        medical: ['–ë–æ–ª—å–Ω–∏—Ü–∞', '–ö–ª–∏–Ω–∏–∫–∞', '–ü–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∞', '–ì–æ—Å–ø–∏—Ç–∞–ª—å', '–õ–∞–∑–∞—Ä–µ—Ç', '–°–∞–Ω–∞—Ç–æ—Ä–∏–π', '–ê–ø—Ç–µ–∫–∞', '–ú–µ–¥—Ü–µ–Ω—Ç—Ä', '–î–∏—Å–ø–∞–Ω—Å–µ—Ä'],
        government: ['–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è', '–ú—ç—Ä–∏—è', '–ü—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ', '–ü–∞—Ä–ª–∞–º–µ–Ω—Ç', '–î—É–º–∞', '–°–µ–Ω–∞—Ç', '–ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ', '–í–µ–¥–æ–º—Å—Ç–≤–æ'],
        religious: ['–¶–µ—Ä–∫–æ–≤—å', '–•—Ä–∞–º', '–°–æ–±–æ—Ä', '–ú–µ—á–µ—Ç—å', '–°–∏–Ω–∞–≥–æ–≥–∞', '–ü–∞–≥–æ–¥–∞', '–ú–æ–Ω–∞—Å—Ç—ã—Ä—å', '–ß–∞—Å–æ–≤–Ω—è'],
        military: ['–ö–∞–∑–∞—Ä–º–∞', '–®—Ç–∞–±', '–ö–ü–ü', '–ë–ª–æ–∫–ø–æ—Å—Ç', '–§–æ—Ä—Ç', '–ë—É–Ω–∫–µ—Ä', '–ü–æ–ª–∏–≥–æ–Ω', '–ê—Ä—Å–µ–Ω–∞–ª'],
        agriculture: ['–§–µ—Ä–º–∞', '–•—É—Ç–æ—Ä', '–ü–æ–ª–µ', '–¢–µ–ø–ª–∏—Ü–∞', '–û—Ä–∞–Ω–∂–µ—Ä–µ—è', '–°–∞–¥', '–í–∏–Ω–æ–≥—Ä–∞–¥–Ω–∏–∫', '–ü–ª–∞–Ω—Ç–∞—Ü–∏—è']
    };

    let buildingId = 0;
    categories.forEach((cat, catIndex) => {
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–∞—Å—Å–∏–≤ —Ç–∏–ø–æ–≤ –¥–ª—è —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        let types = [];
        if (cat.id.startsWith('res')) types = typeNames.residential;
        else if (cat.id.startsWith('elite')) types = typeNames.elite;
        else if (cat.id.startsWith('dacha')) types = typeNames.dacha;
        else if (cat.id.startsWith('com')) types = typeNames.trade;
        else if (cat.id.startsWith('office')) types = typeNames.office;
        else if (cat.id.startsWith('ind')) types = typeNames.industry;
        else if (cat.id.startsWith('energy')) types = typeNames.energy;
        else if (cat.id.startsWith('inf')) types = typeNames.transport;
        else if (cat.id.startsWith('road')) types = typeNames.road;
        else if (cat.id.startsWith('cul')) types = typeNames.culture;
        else if (cat.id.startsWith('spt')) types = typeNames.sport;
        else if (cat.id.startsWith('edu')) types = typeNames.education;
        else if (cat.id.startsWith('med')) types = typeNames.medical;
        else if (cat.id.startsWith('gov')) types = typeNames.government;
        else if (cat.id.startsWith('rel')) types = typeNames.religious;
        else if (cat.id.startsWith('mil')) types = typeNames.military;
        else if (cat.id.startsWith('agr')) types = typeNames.agriculture;
        else types = ['–û–±—ä–µ–∫—Ç'];

        for (let i = 0; i < 320; i++) {  // 32 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ * 320 = 10240
            const prefix = prefixes[i % prefixes.length];
            const type = types[i % types.length];
            const suffix = suffixes[Math.floor(i / 10) % suffixes.length];
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
            let name;
            const r = i % 6;
            if (r === 0) name = `${prefix} ${type}`;
            else if (r === 1) name = `${type} ${suffix}`;
            else if (r === 2) name = `${prefix} ${type} ${suffix}`;
            else if (r === 3) name = `${type} ‚Ññ${i+1}`;
            else if (r === 4) name = `${prefix} ${suffix}`;
            else name = `${suffix} ${type}`;

            // –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è –∫–æ–º–±–∏–Ω–∞—Ü–∏–µ–π –∏–Ω–¥–µ–∫—Å–æ–≤
            const price = cat.basePrice * (100 + i * 2) * (catIndex + 1);
            const income = Math.floor(price * 0.12) + 10;
            const population = Math.floor(price / 200) + 1;

            buildings[`b${buildingId}`] = {
                id: `b${buildingId}`,
                category: cat.id,
                name: name,
                price: price,
                income: income,
                population: population,
                emoji: cat.emoji,
                color: `hsl(${(catIndex * 11 + i) % 360}, 70%, 60%)`
            };
            buildingId++;
        }
    });

    // ==================== –ö–ê–ú–ï–†–ê –ò –û–¢–†–ò–°–û–í–ö–ê ====================
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        drawCity();
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function gridToScreen(row, col) {
        const x = (col - row) * CONFIG.CELL_SIZE / 2 * gameState.camera.zoom + gameState.camera.x + canvas.width / 2;
        const y = (col + row) * CONFIG.CELL_SIZE / 4 * gameState.camera.zoom + gameState.camera.y + canvas.height / 3;
        return { x, y };
    }

    function screenToGrid(screenX, screenY) {
        let bestDist = Infinity, bestRow = -1, bestCol = -1;
        for (let r = 0; r < CONFIG.GRID_SIZE; r++) {
            for (let c = 0; c < CONFIG.GRID_SIZE; c++) {
                const { x, y } = gridToScreen(r, c);
                const dist = Math.hypot(screenX - x, screenY - y);
                if (dist < bestDist && dist < 60 * gameState.camera.zoom) {
                    bestDist = dist;
                    bestRow = r;
                    bestCol = c;
                }
            }
        }
        return { row: bestRow, col: bestCol };
    }

    function drawCity() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // –ù–µ–±–æ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º
        const skyGrad = ctx.createLinearGradient(0, 0, 0, canvas.height);
        if (gameState.timeOfDay > 0.7) {
            skyGrad.addColorStop(0, '#0b4b72');
            skyGrad.addColorStop(1, '#1f7aa3');
        } else if (gameState.timeOfDay > 0.4) {
            skyGrad.addColorStop(0, '#2c4f6e');
            skyGrad.addColorStop(1, '#4f7a9e');
        } else if (gameState.timeOfDay > 0.2) {
            skyGrad.addColorStop(0, '#1e3a50');
            skyGrad.addColorStop(1, '#345e82');
        } else {
            skyGrad.addColorStop(0, '#0a1a2a');
            skyGrad.addColorStop(1, '#1b3447');
        }
        ctx.fillStyle = skyGrad;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // –°–æ–ª–Ω—Ü–µ/–õ—É–Ω–∞
        ctx.shadowBlur = 80;
        ctx.shadowColor = gameState.timeOfDay > 0.5 ? '#fff9c4' : '#e0e0e0';
        ctx.beginPath();
        ctx.arc(150, 100, gameState.timeOfDay > 0.5 ? 60 : 40, 0, Math.PI*2);
        ctx.fillStyle = gameState.timeOfDay > 0.5 ? '#fff3b0' : '#f0f0f0';
        ctx.fill();

        // –û–±–ª–∞–∫–∞
        ctx.shadowBlur = 50;
        ctx.fillStyle = '#ffffff30';
        for (let i = 0; i < 3; i++) {
            ctx.beginPath();
            ctx.ellipse(300 + i*250, 150 + i*30, 100, 40, 0, 0, Math.PI*2);
            ctx.fill();
        }
        ctx.shadowBlur = 0;

        // –†–∏—Å—É–µ–º –≤—Å–µ –∫–ª–µ—Ç–∫–∏
        for (let r = 0; r < CONFIG.GRID_SIZE; r++) {
            for (let c = 0; c < CONFIG.GRID_SIZE; c++) {
                const { x, y } = gridToScreen(r, c);
                
                // –¢–µ–Ω—å –ø–æ–¥ –∑–¥–∞–Ω–∏—è–º–∏
                ctx.shadowColor = '#2b4d2b';
                ctx.shadowBlur = 15 * gameState.camera.zoom;
                ctx.shadowOffsetY = 5 * gameState.camera.zoom;

                // –ó–µ–º–ª—è
                ctx.fillStyle = '#7cb57c';
                ctx.beginPath();
                ctx.moveTo(x, y - 5 * gameState.camera.zoom);
                ctx.lineTo(x + CONFIG.CELL_SIZE/2 * gameState.camera.zoom, y + CONFIG.CELL_SIZE/4 * gameState.camera.zoom - 5 * gameState.camera.zoom);
                ctx.lineTo(x, y + CONFIG.CELL_SIZE/2 * gameState.camera.zoom - 5 * gameState.camera.zoom);
                ctx.lineTo(x - CONFIG.CELL_SIZE/2 * gameState.camera.zoom, y + CONFIG.CELL_SIZE/4 * gameState.camera.zoom - 5 * gameState.camera.zoom);
                ctx.closePath();
                ctx.fill();

                // –ó–¥–∞–Ω–∏–µ
                const buildingId = gameState.grid[r][c];
                if (buildingId !== 'empty') {
                    const b = buildings[buildingId];
                    if (b) {
                        ctx.shadowBlur = 20 * gameState.camera.zoom;
                        ctx.fillStyle = b.color;
                        ctx.beginPath();
                        ctx.moveTo(x, y - 15 * gameState.camera.zoom);
                        ctx.lineTo(x + CONFIG.CELL_SIZE/2 * gameState.camera.zoom, y + CONFIG.CELL_SIZE/4 * gameState.camera.zoom - 15 * gameState.camera.zoom);
                        ctx.lineTo(x, y + CONFIG.CELL_SIZE/2 * gameState.camera.zoom - 15 * gameState.camera.zoom);
                        ctx.lineTo(x - CONFIG.CELL_SIZE/2 * gameState.camera.zoom, y + CONFIG.CELL_SIZE/4 * gameState.camera.zoom - 15 * gameState.camera.zoom);
                        ctx.closePath();
                        ctx.fill();

                        // –≠–º–æ–¥–∑–∏
                        ctx.shadowBlur = 0;
                        ctx.font = `${28 * gameState.camera.zoom}px 'Segoe UI Emoji'`;
                        ctx.fillStyle = 'white';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillText(b.emoji, x, y - 10 * gameState.camera.zoom);
                    }
                }
            }
        }

        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–ª–µ—Ç–∫–∏
        if (selectedRow !== -1 && selectedCol !== -1) {
            const { x, y } = gridToScreen(selectedRow, selectedCol);
            ctx.shadowColor = '#ffdf7e';
            ctx.shadowBlur = 40;
            ctx.strokeStyle = '#ffdb7e';
            ctx.lineWidth = 6;
            ctx.beginPath();
            ctx.moveTo(x, y - 20 * gameState.camera.zoom);
            ctx.lineTo(x + CONFIG.CELL_SIZE/2 * gameState.camera.zoom, y + CONFIG.CELL_SIZE/4 * gameState.camera.zoom - 20 * gameState.camera.zoom);
            ctx.lineTo(x, y + CONFIG.CELL_SIZE/2 * gameState.camera.zoom - 20 * gameState.camera.zoom);
            ctx.lineTo(x - CONFIG.CELL_SIZE/2 * gameState.camera.zoom, y + CONFIG.CELL_SIZE/4 * gameState.camera.zoom - 20 * gameState.camera.zoom);
            ctx.closePath();
            ctx.stroke();
        }

        // –ü–æ–≥–æ–¥–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
        if (gameState.weather === 'rain') {
            ctx.fillStyle = '#a9d6e560';
            for (let i = 0; i < 150; i++) {
                ctx.fillRect(Math.random() * canvas.width, Math.random() * canvas.height, 2, 20);
            }
        } else if (gameState.weather === 'snow') {
            ctx.fillStyle = '#ffffff90';
            for (let i = 0; i < 120; i++) {
                ctx.beginPath();
                ctx.arc(Math.random() * canvas.width, Math.random() * canvas.height, 4, 0, Math.PI*2);
                ctx.fill();
            }
        }
    }

    // ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–ê–ú–ï–†–û–ô ====================
    let selectedRow = -1, selectedCol = -1;

    canvas.addEventListener('mousedown', (e) => {
        gameState.isDragging = true;
        gameState.lastMouseX = e.clientX;
        gameState.lastMouseY = e.clientY;
    });
    canvas.addEventListener('mousemove', (e) => {
        if (gameState.isDragging) {
            gameState.camera.x += e.clientX - gameState.lastMouseX;
            gameState.camera.y += e.clientY - gameState.lastMouseY;
            gameState.lastMouseX = e.clientX;
            gameState.lastMouseY = e.clientY;
            drawCity();
        }
    });
    canvas.addEventListener('mouseup', () => gameState.isDragging = false);
    canvas.addEventListener('mouseleave', () => gameState.isDragging = false);

    canvas.addEventListener('wheel', (e) => {
        e.preventDefault();
        const delta = e.deltaY > 0 ? -CONFIG.ZOOM_SPEED : CONFIG.ZOOM_SPEED;
        gameState.camera.zoom = Math.max(CONFIG.MIN_ZOOM, Math.min(CONFIG.MAX_ZOOM, gameState.camera.zoom + delta));
        drawCity();
    });

    canvas.addEventListener('click', (e) => {
        if (gameState.isDragging) return;
        const rect = canvas.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        const mouseY = e.clientY - rect.top;
        const { row, col } = screenToGrid(mouseX, mouseY);
        if (row !== -1 && col !== -1) {
            selectedRow = row;
            selectedCol = col;
            if (gameState.selectedBuilding) {
                buildAt(row, col);
            } else {
                showInfo(row, col);
            }
            drawCity();
        }
    });

    // Touch
    canvas.addEventListener('touchstart', (e) => {
        e.preventDefault();
        const touch = e.touches[0];
        gameState.isDragging = true;
        gameState.lastMouseX = touch.clientX;
        gameState.lastMouseY = touch.clientY;
    });
    canvas.addEventListener('touchmove', (e) => {
        e.preventDefault();
        if (gameState.isDragging) {
            const touch = e.touches[0];
            gameState.camera.x += touch.clientX - gameState.lastMouseX;
            gameState.camera.y += touch.clientY - gameState.lastMouseY;
            gameState.lastMouseX = touch.clientX;
            gameState.lastMouseY = touch.clientY;
            drawCity();
        }
    });
    canvas.addEventListener('touchend', () => gameState.isDragging = false);

    // ==================== –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ====================
    function buildAt(row, col) {
        if (!gameState.selectedBuilding) {
            showNotification('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –∑–¥–∞–Ω–∏–µ', 'error');
            return;
        }
        const b = buildings[gameState.selectedBuilding];
        if (!b) return;
        if (gameState.money < b.price) {
            showNotification(`‚ùå –ù—É–∂–Ω–æ ${b.price.toLocaleString()}üí∞`, 'error');
            return;
        }
        if (gameState.grid[row][col] !== 'empty') {
            showNotification('‚ùå –ö–ª–µ—Ç–∫–∞ –∑–∞–Ω—è—Ç–∞', 'error');
            return;
        }
        gameState.money -= b.price;
        gameState.grid[row][col] = gameState.selectedBuilding;
        gameState.population += b.population;
        gameState.buildingsCount++;
        updateUI();
        drawCity();
        saveGame();
        showNotification(`‚úÖ –ü–æ—Å—Ç—Ä–æ–µ–Ω–æ: ${b.name}`, 'success');
        if (tg) tg.HapticFeedback?.impactOccurred('light');
    }

    function showInfo(row, col) {
        const id = gameState.grid[row][col];
        if (id === 'empty') {
            document.getElementById('infoPanel').innerHTML = 'üå± –ü—É—Å—Ç–æ–π —É—á–∞—Å—Ç–æ–∫. –í—ã–±–µ—Ä–∏—Ç–µ –∑–¥–∞–Ω–∏–µ.';
        } else {
            const b = buildings[id];
            document.getElementById('infoPanel').innerHTML = `${b.emoji} ${b.name} | üí∞ ${b.income.toLocaleString()}/—Å–±–æ—Ä | üë• +${b.population}`;
        }
    }

    function collectTaxes() {
        const now = Date.now();
        if (now - gameState.lastTaxTime < CONFIG.TAX_COOLDOWN) {
            const sec = Math.ceil((CONFIG.TAX_COOLDOWN - (now - gameState.lastTaxTime)) / 1000);
            showNotification(`‚è≥ –ü–æ–¥–æ–∂–¥–∏—Ç–µ ${sec} —Å–µ–∫.`, 'warning');
            return;
        }
        let total = 0;
        for (let r = 0; r < CONFIG.GRID_SIZE; r++) {
            for (let c = 0; c < CONFIG.GRID_SIZE; c++) {
                const id = gameState.grid[r][c];
                if (id !== 'empty' && buildings[id]) total += buildings[id].income;
            }
        }
        gameState.money += total;
        gameState.lastTaxTime = now;
        updateUI();
        saveGame();
        showNotification(`üí∞ –°–æ–±—Ä–∞–Ω–æ ${total.toLocaleString()} –º–æ–Ω–µ—Ç!`, 'success');
        if (tg) tg.HapticFeedback?.notificationOccurred('success');
    }

    function toggleWeather() {
        const weathers = ['clear', 'rain', 'snow'];
        gameState.weather = weathers[(weathers.indexOf(gameState.weather) + 1) % weathers.length];
        drawCity();
        showNotification(`üå¶Ô∏è –ü–æ–≥–æ–¥–∞: ${gameState.weather === 'clear' ? '–Ø—Å–Ω–æ' : gameState.weather === 'rain' ? '–î–æ–∂–¥—å' : '–°–Ω–µ–≥'}`, 'info');
    }

    function toggleTime() {
        gameState.timeOfDay = (gameState.timeOfDay + 0.25) % 1;
        drawCity();
        const timeStr = gameState.timeOfDay > 0.7 ? '–î–µ–Ω—å' : (gameState.timeOfDay > 0.4 ? '–í–µ—á–µ—Ä' : (gameState.timeOfDay > 0.2 ? '–°—É–º–µ—Ä–∫–∏' : '–ù–æ—á—å'));
        showNotification(`‚è∞ –í—Ä–µ–º—è: ${timeStr}`, 'info');
    }

    function showStats() {
        const totalBuildings = gameState.buildingsCount;
        const totalPopulation = gameState.population;
        const totalIncome = Array.from({ length: CONFIG.GRID_SIZE }, (_, r) =>
            Array.from({ length: CONFIG.GRID_SIZE }, (_, c) => {
                const id = gameState.grid[r][c];
                return id !== 'empty' && buildings[id] ? buildings[id].income : 0;
            }).reduce((a, b) => a + b, 0)
        ).reduce((a, b) => a + b, 0);
        showNotification(`üìä –ü–æ—Å—Ç—Ä–æ–µ–∫: ${totalBuildings} | –ñ–∏—Ç–µ–ª–µ–π: ${totalPopulation} | –î–æ—Ö–æ–¥: ${totalIncome}/—Å–±–æ—Ä`, 'info');
    }

    function resetGame() {
        if (confirm('–ù–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –≥–æ—Ä–æ–¥? –í–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω!')) {
            gameState.money = CONFIG.START_MONEY;
            gameState.population = 0;
            gameState.buildingsCount = 0;
            gameState.lastTaxTime = Date.now();
            gameState.selectedBuilding = null;
            for (let r = 0; r < CONFIG.GRID_SIZE; r++) {
                for (let c = 0; c < CONFIG.GRID_SIZE; c++) {
                    gameState.grid[r][c] = 'empty';
                }
            }
            document.querySelectorAll('.build-item').forEach(i => i.classList.remove('selected'));
            document.querySelectorAll('.cat-tab').forEach(t => t.classList.remove('active'));
            document.querySelector('[data-cat="all"]')?.classList.add('active');
            gameState.currentCategory = 'all';
            updateUI();
            drawCity();
            saveGame();
            showNotification('üîÑ –ù–æ–≤—ã–π –≥–æ—Ä–æ–¥ —Å–æ–∑–¥–∞–Ω', 'info');
        }
    }

    function saveGame() {
        const data = {
            money: gameState.money,
            grid: gameState.grid,
            population: gameState.population,
            buildingsCount: gameState.buildingsCount,
            weather: gameState.weather,
            timeOfDay: gameState.timeOfDay
        };
        if (tg) tg.sendData(JSON.stringify(data));
        localStorage.setItem('grandCity10k', JSON.stringify(data));
        showNotification('üíæ –ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞', 'success');
    }

    function loadGame() {
        const saved = localStorage.getItem('grandCity10k');
        if (saved) {
            try {
                const data = JSON.parse(saved);
                gameState.money = data.money || CONFIG.START_MONEY;
                if (data.grid) gameState.grid = data.grid;
                gameState.population = data.population || 0;
                gameState.buildingsCount = data.buildingsCount || 0;
                gameState.weather = data.weather || 'clear';
                gameState.timeOfDay = data.timeOfDay || 0.6;
                updateUI();
                drawCity();
                showNotification('üìÇ –ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'success');
            } catch (e) {
                showNotification('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏', 'error');
            }
        } else {
            showNotification('‚ùå –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
        }
    }

    // ==================== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê ====================
    function updateUI() {
        document.getElementById('moneyDisplay').innerText = gameState.money.toLocaleString();
        document.getElementById('popDisplay').innerText = gameState.population.toLocaleString();
        let totalIncome = 0;
        for (let r = 0; r < CONFIG.GRID_SIZE; r++) {
            for (let c = 0; c < CONFIG.GRID_SIZE; c++) {
                const id = gameState.grid[r][c];
                if (id !== 'empty' && buildings[id]) totalIncome += buildings[id].income;
            }
        }
        document.getElementById('incomeDisplay').innerText = totalIncome.toLocaleString();
        document.getElementById('buildingsCount').innerText = `${gameState.buildingsCount}/${CONFIG.GRID_SIZE * CONFIG.GRID_SIZE}`;
    }

    function showNotification(msg, type) {
        const notif = document.createElement('div');
        notif.className = 'notification';
        notif.textContent = msg;
        if (type === 'success') notif.style.borderColor = '#4caf50';
        else if (type === 'error') notif.style.borderColor = '#f44336';
        else if (type === 'warning') notif.style.borderColor = '#ff9800';
        document.body.appendChild(notif);
        setTimeout(() => notif.remove(), 3000);
    }

    // ==================== –ü–û–°–¢–†–û–ï–ù–ò–ï –ú–ï–ù–Æ ====================
    function buildMenu() {
        const tabs = document.getElementById('categoryTabs');
        const list = document.getElementById('buildingsList');

        // –ö–Ω–æ–ø–∫–∞ "–í—Å–µ"
        const allBtn = document.createElement('button');
        allBtn.className = 'cat-tab active';
        allBtn.dataset.cat = 'all';
        allBtn.textContent = 'üèÅ –í–°–ï';
        tabs.appendChild(allBtn);

        categories.forEach(cat => {
            const btn = document.createElement('button');
            btn.className = 'cat-tab';
            btn.dataset.cat = cat.id;
            btn.textContent = `${cat.emoji} ${cat.name}`;
            tabs.appendChild(btn);
        });

        function showCategory(catId) {
            list.innerHTML = '';
            let arr = Object.values(buildings);
            if (catId !== 'all') arr = arr.filter(b => b.category === catId);
            arr.sort((a,b) => a.price - b.price);
            arr.forEach(b => {
                const item = document.createElement('div');
                item.className = 'build-item';
                item.dataset.id = b.id;
                item.innerHTML = `
                    <div class="item-icon">${b.emoji}</div>
                    <div class="item-info">
                        <div class="item-name">${b.name}</div>
                        <div class="item-price">üí∞ ${b.price.toLocaleString()}</div>
                    </div>
                `;
                item.addEventListener('click', () => {
                    document.querySelectorAll('.build-item').forEach(i => i.classList.remove('selected'));
                    item.classList.add('selected');
                    gameState.selectedBuilding = b.id;
                    document.getElementById('infoPanel').innerHTML = `–í—ã–±—Ä–∞–Ω–æ: ${b.name}`;
                });
                list.appendChild(item);
            });
        }

        document.querySelectorAll('.cat-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.cat-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                showCategory(tab.dataset.cat);
            });
        });

        showCategory('all');
    }

    // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
    function init() {
        buildMenu();
        document.getElementById('collectBtn').addEventListener('click', collectTaxes);
        document.getElementById('weatherBtn').addEventListener('click', toggleWeather);
        document.getElementById('timeBtn').addEventListener('click', toggleTime);
        document.getElementById('statsBtn').addEventListener('click', showStats);
        document.getElementById('cancelBtn').addEventListener('click', () => {
            gameState.selectedBuilding = null;
            document.querySelectorAll('.build-item').forEach(i => i.classList.remove('selected'));
            document.getElementById('infoPanel').innerHTML = 'üëÜ –í—ã–±–µ—Ä–∏—Ç–µ –∑–¥–∞–Ω–∏–µ';
        });
        document.getElementById('resetBtn').addEventListener('click', resetGame);
        document.getElementById('saveBtn').addEventListener('click', saveGame);
        document.getElementById('loadBtn').addEventListener('click', loadGame);

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–ª–∏ –Ω–∞—á–∞–ª–æ –Ω–æ–≤–æ–π –∏–≥—Ä—ã
        const saved = localStorage.getItem('grandCity10k');
        if (saved) loadGame(); else {
            updateUI();
            drawCity();
        }

        setInterval(saveGame, 60000); // –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–∑ –≤ –º–∏–Ω—É—Ç—É
    }

    init();
})();
</script>
<!-- 
================================================================================
–§–ò–ù–ê–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø: 10240 –£–ù–ò–ö–ê–õ–¨–ù–´–• –ó–î–ê–ù–ò–ô, 6400 –ö–õ–ï–¢–û–ö, 8 –ö–ù–û–ü–û–ö –£–ü–†–ê–í–õ–ï–ù–ò–Ø
–í–°–ï –ö–ù–û–ü–ö–ò –†–ê–ë–û–¢–ê–Æ–¢, –ö–ê–ú–ï–†–ê –î–í–ò–ì–ê–ï–¢–°–Ø, –ü–û–ì–û–î–ê –ò –í–†–ï–ú–Ø –ú–ï–ù–Ø–Æ–¢–°–Ø, –ï–°–¢–¨ –°–û–•–†–ê–ù–ï–ù–ò–ï
================================================================================
-->
</body>
</html>
